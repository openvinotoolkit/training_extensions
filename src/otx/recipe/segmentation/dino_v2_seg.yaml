# @package _global_
defaults:
  - override /base: segmentation
  - override /callbacks: segmentation
  - override /data: segmentation
  - override /model: mmseg
data:
  train_subset:
    batch_size: 8
    transforms:
      - type: LoadImageFromFile
      - reduce_zero_label: true
        type: LoadAnnotations
      - keep_ratio: false
        ratio_range:
          - 0.5
          - 2.0
        scale:
          - 640
          - 640
        type: RandomResize
      - cat_max_ratio: 0.75
        crop_size:
          - 560
          - 560
        type: RandomCrop
      - prob: 0.5
        type: RandomFlip
      - type: PhotoMetricDistortion
      - type: PackSegInputs
  val_subset:
    batch_size: 1
    transforms:
      - type: LoadImageFromFile
      - keep_ratio: false
        scale:
          - 560
          - 560
        type: Resize
      - reduce_zero_label: true
        type: LoadAnnotations
      - type: PackSegInputs
  test_subset:
    batch_size: 1
    transforms:
      - type: LoadImageFromFile
      - keep_ratio: false
        scale:
          - 560
          - 560
        type: Resize
      - reduce_zero_label: true
        type: LoadAnnotations
      - type: PackSegInputs
model:
  otx_model:
    config:
      backbone:
        name: dinov2_vits14_reg
        freeze_backbone: true
        out_index:
          - 8
          - 9
          - 10
          - 11
        type: DinoVisionTransformer
      data_preprocessor:
        bgr_to_rgb: true
        mean:
          - 123.675
          - 116.28
          - 103.53
        pad_val: 0
        seg_pad_val: 255
        size:
          - 560
          - 560
        std:
          - 58.395
          - 57.12
          - 57.375
        test_cfg:
          size_divisor: 14
        type: SegDataPreProcessor
      decode_head:
        init_cfg:
          checkpoint: https://dl.fbaipublicfiles.com/dinov2/dinov2_vits14/dinov2_vits14_ade20k_linear_head.pth
          type: Pretrained
          prefix: decode_head
        type: FCNHead
        in_channels:
          - 384
          - 384
          - 384
          - 384
        in_index:
          - 0
          - 1
          - 2
          - 3
        input_transform: resize_concat
        channels: 1536
        kernel_size: 1
        num_convs: 1
        concat_input: false
        dropout_ratio: -1
        num_classes: 2
        norm_cfg:
          type: SyncBN
          requires_grad: true
        align_corners: false
        loss_decode:
          type: CrossEntropyLoss
          use_sigmoid: false
          loss_weight: 1.0
      pretrained: null
      test_cfg:
        mode: whole
      train_cfg: {}
      type: EncoderDecoder
  optimizer:
    _target_: torch.optim.AdamW
    _partial_: true
    lr: 0.001
    betas: [0.9, 0.999]
    weight_decay: 0.0001
  scheduler:
    total_iters: 100
    power: 0.9
    last_epoch: -1
