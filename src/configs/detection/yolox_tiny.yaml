engine: ../engine/detection.yaml

model:
  class_path: otx.core.model.module.detection.OTXDetectionLitModule
  init_args:
    torch_compile: false
    otx_model:
      class_path: otx.core.model.entity.detection.MMDetCompatibleModel
      init_args:
        config:
          load_from: https://storage.openvinotoolkit.org/repositories/openvino_training_extensions/models/object_detection/v2/yolox_tiny_8x8.pth
          train_cfg:
            assigner:
              type: SimOTAAssigner
              center_radius: 2.5
          test_cfg:
            score_thr: 0.01
            nms:
              type: nms
              iou_threshold: 0.65
            max_per_img: 100
          type: YOLOX
          data_preprocessor:
            type: DetDataPreprocessor
            mean:
              - 123.675
              - 116.28
              - 103.53
            std:
              - 58.395
              - 57.12
              - 57.375
            bgr_to_rgb: true
            pad_size_divisor: 32
          backbone:
            type: CSPDarknet
            deepen_factor: 0.33
            widen_factor: 0.375
            out_indices:
              - 2
              - 3
              - 4
          neck:
            type: YOLOXPAFPN
            in_channels:
              - 96
              - 192
              - 384
            out_channels: 96
            num_csp_blocks: 1
          bbox_head:
            type: YOLOXHead
            num_classes: 80
            in_channels: 96
            feat_channels: 96
    optimizer:
      class_path: torch.optim.SGD
      init_args:
        lr: 0.0002
        weight_decay: 0.001
        momentum: 0.9
    scheduler:
      class_path: lightning.pytorch.cli.ReduceLROnPlateau
      init_args:
        mode: min
        factor: 0.5
        patience: 1
        monitor: train/loss

data:
  task: DETECTION
  config:
    mem_cache_size: 1GB
    mem_cache_img_max_size: null
    data_format: coco_instances
    train_subset:
      subset_name: train
      batch_size: 8
      num_workers: 2
      transform_lib_type: MMDET
      transforms:
        - type: LoadImageFromFile
        - type: LoadAnnotations
          with_bbox: true
        - type: CachedMosaic
          random_pop: false
          pad_val: 114.0
          max_cached_images: 20
          img_scale:
            - 640
            - 640
        - type: RandomAffine
          scaling_ratio_range:
            - 0.5
            - 1.5
          border:
            - -320
            - -320
        - type: PhotoMetricDistortion
          brightness_delta: 32
          contrast_range:
            - 0.5
            - 1.5
          saturation_range:
            - 0.5
            - 1.5
          hue_delta: 18
        - type: Resize
          scale:
            - 640
            - 640
          keep_ratio: false
        - type: RandomFlip
          prob: 0.5
        - type: Pad
          pad_to_square: true
          pad_val: 114
        - type: PackDetInputs
          meta_keys:
            - ori_filename
            - flip_direction
            - scale_factor
            - gt_ann_ids
            - flip
            - ignored_labels
            - ori_shape
            - filename
            - img_shape
            - pad_shape
    val_subset:
      subset_name: val
      num_workers: 2
      batch_size: 1
      transform_lib_type: MMDET
      transforms:
        - type: LoadImageFromFile
        - type: Resize
          scale:
            - 416
            - 416
          keep_ratio: false
        - type: LoadAnnotations
          with_bbox: true
        - type: PackDetInputs
          meta_keys:
            - ori_filename
            - scale_factor
            - ori_shape
            - filename
            - img_shape
            - pad_shape
    test_subset:
      subset_name: test
      num_workers: 2
      batch_size: 1
      transform_lib_type: MMDET
      transforms:
        - type: LoadImageFromFile
        - type: Resize
          scale:
            - 416
            - 416
          keep_ratio: false
        - type: LoadAnnotations
          with_bbox: true
        - type: PackDetInputs
          meta_keys:
            - ori_filename
            - scale_factor
            - ori_shape
            - filename
            - img_shape
            - pad_shape
