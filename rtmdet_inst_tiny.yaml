# @package _global_
defaults:
- override /base: detection
- override /data: mmdet
- override /model: mmdet
data:
  subsets:
    train:
      batch_size: 32
      transforms:
      - type: LoadImageFromFile
        backend_args: null
      - type: LoadAnnotations
        with_bbox: true
        with_mask: true
        poly2mask: false
      - type: CachedMosaic
        img_scale:
        - 640
        - 640
        pad_val: 114.0
        max_cached_images: 20
        random_pop: false
      - type: RandomResize
        scale:
        - 1280
        - 1280
        ratio_range:
        - 0.5
        - 2.0
        keep_ratio: true
      - type: RandomCrop
        crop_size:
        - 640
        - 640
      - type: YOLOXHSVRandomAug
      - type: RandomFlip
        prob: 0.5
      - type: Pad
        size:
        - 640
        - 640
        pad_val:
          img:
          - 114
          - 114
          - 114
      - type: CachedMixUp
        img_scale:
        - 640
        - 640
        ratio_range:
        - 1.0
        - 1.0
        max_cached_images: 10
        random_pop: false
        pad_val:
        - 114
        - 114
        - 114
        prob: 0.5
      - type: FilterAnnotations
        min_gt_bbox_wh:
        - 1
        - 1
      - type: PackDetInputs
    val:
      batch_size: 5
      transforms:
      - type: LoadImageFromFile
        backend_args: null
      - type: Resize
        scale:
        - 640
        - 640
        keep_ratio: true
      - type: Pad
        size:
        - 640
        - 640
        pad_val:
          img:
          - 114
          - 114
          - 114
      - type: LoadAnnotations
        with_bbox: true
      - type: PackDetInputs
        meta_keys:
        - img_id
        - img_path
        - ori_shape
        - img_shape
        - scale_factor
model:
  otx_model:
    config:
      type: RTMDet
      data_preprocessor:
        type: DetDataPreprocessor
        mean:
        - 103.53
        - 116.28
        - 123.675
        std:
        - 57.375
        - 57.12
        - 58.395
        bgr_to_rgb: false
        batch_augments: null
      backbone:
        type: CSPNeXt
        arch: P5
        expand_ratio: 0.5
        deepen_factor: 0.167
        widen_factor: 0.375
        channel_attention: true
        norm_cfg:
          type: SyncBN
        act_cfg:
          type: SiLU
          inplace: true
        init_cfg:
          type: Pretrained
          prefix: backbone.
          checkpoint: https://download.openmmlab.com/mmdetection/v3.0/rtmdet/cspnext_rsb_pretrain/cspnext-tiny_imagenet_600e.pth
      neck:
        type: CSPNeXtPAFPN
        in_channels:
        - 96
        - 192
        - 384
        out_channels: 96
        num_csp_blocks: 1
        expand_ratio: 0.5
        norm_cfg:
          type: SyncBN
        act_cfg:
          type: SiLU
          inplace: true
      bbox_head:
        type: RTMDetInsSepBNHead
        num_classes: 80
        in_channels: 96
        stacked_convs: 2
        share_conv: true
        pred_kernel_size: 1
        feat_channels: 96
        act_cfg:
          type: SiLU
          inplace: true
        norm_cfg:
          type: SyncBN
          requires_grad: true
        anchor_generator:
          type: MlvlPointGenerator
          offset: 0
          strides:
          - 8
          - 16
          - 32
        bbox_coder:
          type: DistancePointBBoxCoder
        loss_cls:
          type: QualityFocalLoss
          use_sigmoid: true
          beta: 2.0
          loss_weight: 1.0
        loss_bbox:
          type: GIoULoss
          loss_weight: 2.0
        loss_mask:
          type: DiceLoss
          loss_weight: 2.0
          eps: 5.0e-06
          reduction: mean
      train_cfg:
        assigner:
          type: DynamicSoftLabelAssigner
          topk: 13
        allowed_border: -1
        pos_weight: -1
        debug: false
      test_cfg:
        nms_pre: 1000
        min_bbox_size: 0
        score_thr: 0.05
        nms:
          type: nms
          iou_threshold: 0.6
        max_per_img: 100
        mask_thr_binary: 0.5
