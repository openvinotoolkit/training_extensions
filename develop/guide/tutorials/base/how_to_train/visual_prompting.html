<!DOCTYPE html>

<html lang="en" data-content_root="../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Visual Prompting model &#8212; OpenVINO™ Training Extensions 2.3.0rc0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../../../../_static/styles/bootstrap.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">

  
  <link href="../../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=796348d33e8b1d947c94" rel="stylesheet">
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/tabs.css?v=a5c4661c" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/css/custom.css?v=0a108b04" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94">
<link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94">

    <script src="../../../../_static/documentation_options.js?v=931ecc87"></script>
    <script src="../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'guide/tutorials/base/how_to_train/visual_prompting';</script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="XAI Tutorial" href="../explain.html" />
    <link rel="prev" title="Action Classification model" href="action_classification.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../../../../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search" aria-label="Search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../../../../index.html">

  
  
  
  
  
  
  

  
    <img src="../../../../_static/logos/otx-logo.png" class="logo__image only-light" alt="Logo image">
    <img src="../../../../_static/logos/otx-logo.png" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
    </div>

    <div id="navbar-end">
      
        <div class="navbar-end-item navbar-persistent--container">
          
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
        </div>
      
      
      <div class="navbar-end-item">
        
<form class="bd-search d-flex align-items-center" action="../../../../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search" aria-label="Search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
      </div>
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://github.com/openvinotoolkit/training_extensions" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><img src="../../../../_static/logos/github_icon.png" class="icon-link-image" alt="GitHub"/></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>


  
  
    <div class="navbar-persistent--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
    </div>
  

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        
<form class="bd-search d-flex align-items-center" action="../../../../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search" aria-label="Search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
      </div>
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://github.com/openvinotoolkit/training_extensions" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><img src="../../../../_static/logos/github_icon.png" class="icon-link-image" alt="GitHub"/></a>
        </li>
      </ul>
      </div>
      
    </div>
    
  </div>

  
  <div class="sidebar-start-items sidebar-primary__section">
    <div class="sidebar-start-items__item"><nav class="bd-links" id="bd-docs-nav" aria-label="Section navigation">
  <p class="bd-links__title" role="heading" aria-level="1">
    Section Navigation
  </p>
  <div class="bd-toc-item navbar-nav">
    <p aria-level="2" class="caption" role="heading"><span class="caption-text">Get Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/installation.html"><svg aria-hidden="true" class="sd-octicon sd-octicon-package" height="1.0em" version="1.1" viewbox="0 0 16 16" width="1.0em"><path d="m8.878.392 5.25 3.045c.54.314.872.89.872 1.514v6.098a1.75 1.75 0 0 1-.872 1.514l-5.25 3.045a1.75 1.75 0 0 1-1.756 0l-5.25-3.045A1.75 1.75 0 0 1 1 11.049V4.951c0-.624.332-1.201.872-1.514L7.122.392a1.75 1.75 0 0 1 1.756 0ZM7.875 1.69l-4.63 2.685L8 7.133l4.755-2.758-4.63-2.685a.248.248 0 0 0-.25 0ZM2.5 5.677v5.372c0 .09.047.171.125.216l4.625 2.683V8.432Zm6.25 8.271 4.625-2.683a.25.25 0 0 0 .125-.216V5.677L8.75 8.432Z"></path></svg> Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/cli_commands.html"><svg aria-hidden="true" class="sd-octicon sd-octicon-terminal" height="1.0em" version="1.1" viewbox="0 0 16 16" width="1.0em"><path d="M0 2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75v10.5A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25Zm1.75-.25a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h12.5a.25.25 0 0 0 .25-.25V2.75a.25.25 0 0 0-.25-.25ZM7.25 8a.749.749 0 0 1-.22.53l-2.25 2.25a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L5.44 8 3.72 6.28a.749.749 0 0 1 .326-1.275.749.749 0 0 1 .734.215l2.25 2.25c.141.14.22.331.22.53Zm1.5 1.5h3a.75.75 0 0 1 0 1.5h-3a.75.75 0 0 1 0-1.5Z"></path></svg> CLI Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/api_tutorial.html"><svg aria-hidden="true" class="sd-octicon sd-octicon-code-square" height="1.0em" version="1.1" viewbox="0 0 16 16" width="1.0em"><path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v12.5A1.75 1.75 0 0 1 14.25 16H1.75A1.75 1.75 0 0 1 0 14.25Zm1.75-.25a.25.25 0 0 0-.25.25v12.5c0 .138.112.25.25.25h12.5a.25.25 0 0 0 .25-.25V1.75a.25.25 0 0 0-.25-.25Zm7.47 3.97a.75.75 0 0 1 1.06 0l2 2a.75.75 0 0 1 0 1.06l-2 2a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L10.69 8 9.22 6.53a.75.75 0 0 1 0-1.06ZM6.78 6.53 5.31 8l1.47 1.47a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215l-2-2a.75.75 0 0 1 0-1.06l2-2a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042Z"></path></svg> API Quick-Guide</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../index.html">Base Tutorials</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 current active has-children"><a class="reference internal" href="index.html">Training to deployment tutorials</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="classification.html">Classification  model</a></li>
<li class="toctree-l3"><a class="reference internal" href="detection.html">Object Detection model</a></li>
<li class="toctree-l3"><a class="reference internal" href="instance_segmentation.html">Instance Segmentation model</a></li>
<li class="toctree-l3"><a class="reference internal" href="semantic_segmentation.html">Semantic Segmentation model</a></li>
<li class="toctree-l3"><a class="reference internal" href="anomaly_detection.html">Anomaly Detection Tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="action_classification.html">Action Classification model</a></li>
<li class="toctree-l3 current active"><a class="current reference internal" href="#">Visual Prompting model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../explain.html">XAI Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../export.html">Deploy &amp; Demo</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../advanced/index.html">Advanced Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../advanced/configuration.html">How to write OTX Configuration (recipe)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced/semi_supervised_learning.html">Use Semi-Supervised Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced/huggingface_model.html">Training with Hugging Face pretrained vision models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced/multi_gpu.html">Multi-GPU Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced/low_rank_adaptation.html">LoRA: Low Rank Adaptation for Classification Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../advanced/torch_compile.html">[BETA] Enable torch.compile</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Explanation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../explanation/algorithms/index.html">Algorithms</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../explanation/algorithms/classification/index.html">Classification</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../explanation/algorithms/classification/multi_class_classification.html">Multi-class Classification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../explanation/algorithms/classification/multi_label_classification.html">Multi-label Classification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../explanation/algorithms/classification/hierarhical_classification.html">Hierarchical Classification</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../explanation/algorithms/object_detection/index.html">Object Detection</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../explanation/algorithms/object_detection/object_detection.html">Object Detection</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../explanation/algorithms/segmentation/index.html">Segmentation</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../explanation/algorithms/segmentation/semantic_segmentation.html">Semantic Segmentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../explanation/algorithms/segmentation/instance_segmentation.html">Instance Segmentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../explanation/algorithms/anomaly/index.html">Anomaly Detection</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../explanation/algorithms/action/index.html">Action Recognition</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../explanation/algorithms/action/action_classification.html">Action Classification</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../explanation/algorithms/visual_prompting/index.html">Visual Prompting</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../explanation/algorithms/visual_prompting/fine_tuning.html">Visual Prompting (Fine-tuning)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../explanation/algorithms/visual_prompting/zero_shot.html">Visual Prompting (Zero-shot learning)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../explanation/additional_features/index.html">Additional Features</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../explanation/additional_features/models_optimization.html">Models Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../explanation/additional_features/hpo.html">Hyperparameters Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../explanation/additional_features/auto_configuration.html">Auto-configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../explanation/additional_features/adaptive_training.html">Adaptive Training</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../explanation/additional_features/xai.html">Explainable AI (XAI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../explanation/additional_features/fast_data_loading.html">Fast Data Loading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../explanation/additional_features/tiling.html">Improve Small Object Detection with Image Tiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../explanation/additional_features/class_incremental_sampler.html">Class-Incremental Sampler</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../../explanation/additional_features/configurable_input_size.html">Configurable Input Size</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../explanation/product_design.html">Product Design</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../reference/index.html">API reference</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../reference/_autosummary/otx.html">otx</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/_autosummary/otx.algo.html">otx.algo</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/_autosummary/otx.algo.strategies.html">otx.algo.strategies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/_autosummary/otx.algo.accelerators.html">otx.algo.accelerators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/_autosummary/otx.algo.plugins.html">otx.algo.plugins</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/_autosummary/otx.cli.html">otx.cli</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-14"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/_autosummary/otx.cli.cli.html">otx.cli.cli</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/_autosummary/otx.cli.install.html">otx.cli.install</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/_autosummary/otx.cli.utils.html">otx.cli.utils</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/_autosummary/otx.core.html">otx.core</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-15"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/_autosummary/otx.core.config.html">otx.core.config</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/_autosummary/otx.core.data.html">otx.core.data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/_autosummary/otx.core.exporter.html">otx.core.exporter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/_autosummary/otx.core.metrics.html">otx.core.metrics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/_autosummary/otx.core.model.html">otx.core.model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/_autosummary/otx.core.optimizer.html">otx.core.optimizer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/_autosummary/otx.core.schedulers.html">otx.core.schedulers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/_autosummary/otx.core.types.html">otx.core.types</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/_autosummary/otx.core.utils.html">otx.core.utils</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/_autosummary/otx.engine.html">otx.engine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/_autosummary/otx.hpo.html">otx.hpo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/_autosummary/otx.recipe.html">otx.recipe</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/_autosummary/otx.tools.html">otx.tools</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-16"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/_autosummary/otx.tools.converter.html">otx.tools.converter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/_autosummary/otx.tools.templates.html">otx.tools.templates</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/_autosummary/otx.utils.html">otx.utils</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Release Notes</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../release_notes/index.html">Releases</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-17"><i class="fa-solid fa-chevron-down"></i></label><ul class="simple">
</ul>
</li>
</ul>

  </div>
</nav>
    </div>
  </div>
  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

  
  <div id="rtd-footer-container"></div>

      </div>
      <main id="main-content" class="bd-main">
        
        
        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                
            </div>
            
            
            <article class="bd-article" role="main">
              
  <section id="visual-prompting-model">
<h1>Visual Prompting model<a class="headerlink" href="#visual-prompting-model" title="Link to this heading">#</a></h1>
<p>This tutorial reveals end-to-end solution from installation to model export and optimization for visual prompting task on a specific example.
On this page, we show how to train, validate, export and optimize SegmentAnything model on a toy dataset.</p>
<p>To learn more about Visual Prompting task, refer to <a class="reference internal" href="../../../explanation/algorithms/visual_prompting/index.html"><span class="doc">Visual Prompting</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To learn deeper how to manage training process of the model including additional parameters and its modification.</p>
</div>
<p>The process has been tested on the following configuration.</p>
<ul class="simple">
<li><p>Ubuntu 18.04</p></li>
<li><p>NVIDIA GeForce RTX 3090</p></li>
<li><p>Intel(R) Core(TM) i9-11900</p></li>
<li><p>CUDA Toolkit 11.8</p></li>
</ul>
<section id="setup-virtual-environment">
<h2>Setup virtual environment<a class="headerlink" href="#setup-virtual-environment" title="Link to this heading">#</a></h2>
<p>1. You can follow the installation process from a <a class="reference internal" href="../../../get_started/installation.html"><span class="doc">quick start guide</span></a>
to create a universal virtual environment for OpenVINO™ Training Extensions.</p>
<p>2. Activate your virtual
environment:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>.otx/bin/activate
<span class="c1"># or by this line, if you created an environment, using tox</span>
.<span class="w"> </span>venv/otx/bin/activate
</pre></div>
</div>
</section>
<section id="dataset-preparation">
<h2>Dataset preparation<a class="headerlink" href="#dataset-preparation" title="Link to this heading">#</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Currently, we support the following visual prompting dataset formats:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://openvinotoolkit.github.io/datumaro/stable/docs/data-formats/formats/common_semantic_segmentation.html">Common Semantic Segmentation</a></p></li>
<li><p><a class="reference external" href="https://openvinotoolkit.github.io/datumaro/stable/docs/data-formats/formats/coco.html">COCO</a></p></li>
<li><p><a class="reference external" href="https://openvinotoolkit.github.io/datumaro/stable/docs/data-formats/formats/pascal_voc.html">Pascal VOC</a></p></li>
<li><p><a class="reference external" href="https://openvinotoolkit.github.io/datumaro/stable/docs/data-formats/formats/datumaro.html">Datumaro</a></p></li>
</ul>
</div>
<p>1. Clone a repository with
<a class="reference external" href="https://github.com/thsant/wgisd">WGISD dataset</a>.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>data<span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>data
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/thsant/wgisd.git
<span class="nb">cd</span><span class="w"> </span>wgisd
git<span class="w"> </span>checkout<span class="w"> </span>6910edc5ae3aae8c20062941b1641821f0c30127
</pre></div>
</div>
<p>This dataset contains images of grapevines with the annotation for different varieties of grapes.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CDY</span></code> - Chardonnay</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CFR</span></code> - Cabernet Franc</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CSV</span></code> - Cabernet Sauvignon</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SVB</span></code> - Sauvignon Blanc</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SYH</span></code> - Syrah</p></li>
</ul>
<p>It’s a great example to start with. The model achieves high accuracy right from the beginning of the training due to relatively large and focused objects. Also, these objects are distinguished by a person, so we can check inference results just by looking at images.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<a class="reference internal image-reference" href="../../../../_images/wgisd_gt_sample.jpg"><img alt="this image uploaded from this `source &lt;https://github.com/thsant/wgisd/blob/master/data/CDY_2015.jpg&gt;`_" src="../../../../_images/wgisd_gt_sample.jpg" style="width: 600px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>2. To run the training using <a class="reference internal" href="../../../explanation/additional_features/auto_configuration.html"><span class="doc">auto-configuration feature</span></a>,
we need to reformat the dataset according to this structure:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>wgisd
├──<span class="w"> </span>annotations/
<span class="w">    </span>├──<span class="w"> </span>instances_train.json
<span class="w">    </span>├──<span class="w"> </span>instances_val.json
<span class="w">    </span><span class="o">(</span>Optional<span class="o">)</span>
<span class="w">    </span>└──<span class="w"> </span>instances_test.json
├──images/
<span class="w">    </span><span class="o">(</span>The<span class="w"> </span>split<span class="w"> </span>on<span class="w"> </span>folders<span class="w"> </span>is<span class="w"> </span>optional<span class="o">)</span>
<span class="w">    </span>├──<span class="w"> </span>train
<span class="w">    </span>├──<span class="w"> </span>val
<span class="w">    </span>└──<span class="w"> </span><span class="nb">test</span>
<span class="o">(</span>There<span class="w"> </span>may<span class="w"> </span>be<span class="w"> </span>more<span class="w"> </span>extra<span class="w"> </span>unrelated<span class="w"> </span>folders<span class="o">)</span>
</pre></div>
</div>
<p>We can do that by running these commands:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># format images folder</span>
mv<span class="w"> </span>data<span class="w"> </span>images

<span class="c1"># format annotations folder</span>
mv<span class="w"> </span>coco_annotations<span class="w"> </span>annotations

<span class="c1"># rename annotations to meet *_train.json pattern</span>
mv<span class="w"> </span>annotations/train_bbox_instances.json<span class="w"> </span>annotations/instances_train.json
mv<span class="w"> </span>annotations/test_bbox_instances.json<span class="w"> </span>annotations/instances_val.json
cp<span class="w"> </span>annotations/instances_val.json<span class="w"> </span>annotations/instances_test.json

<span class="nb">cd</span><span class="w"> </span>../..
</pre></div>
</div>
</section>
<section id="training">
<h2>Training<a class="headerlink" href="#training" title="Link to this heading">#</a></h2>
<p>1. First of all, you need to choose which visual prompting model you want to train.
The list of supported templates for visual prompting is available with the command line below.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The characteristics and detailed comparison of the models could be found in <a class="reference internal" href="../../../explanation/algorithms/visual_prompting/index.html"><span class="doc">Explanation section</span></a>.</p>
</div>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-0" name="sd-tab-set-0" type="radio">
<label class="sd-tab-label" for="sd-tab-item-0">
CLI</label><div class="sd-tab-content docutils">
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>otx<span class="o">)</span><span class="w"> </span>...$<span class="w"> </span>otx<span class="w"> </span>find<span class="w"> </span>--task<span class="w"> </span>VISUAL_PROMPTING
┏━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span class="w"> </span>Task<span class="w">             </span>┃<span class="w"> </span>Model<span class="w"> </span>Name<span class="w">     </span>┃<span class="w"> </span>Recipe<span class="w"> </span>Path<span class="w">                                              </span>┃
┡━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│<span class="w"> </span>VISUAL_PROMPTING<span class="w"> </span>│<span class="w"> </span>sam_tiny_vit<span class="w">   </span>│<span class="w"> </span>src/otx/recipe/visual_prompting/sam_tiny_vit.yaml<span class="w">        </span>│
│<span class="w"> </span>VISUAL_PROMPTING<span class="w"> </span>│<span class="w"> </span>openvino_model<span class="w"> </span>│<span class="w"> </span>src/otx/recipe/visual_prompting/openvino_model.yaml<span class="w">      </span>│
│<span class="w"> </span>VISUAL_PROMPTING<span class="w"> </span>│<span class="w"> </span>sam_vit_b<span class="w">      </span>│<span class="w"> </span>src/otx/recipe/visual_prompting/sam_vit_b.yaml<span class="w">           </span>│
└──────────────────┴────────────────┴──────────────────────────────────────────────────────────┘
</pre></div>
</div>
</div>
<input id="sd-tab-item-1" name="sd-tab-set-0" type="radio">
<label class="sd-tab-label" for="sd-tab-item-1">
API</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">otx.engine.utils.api</span> <span class="kn">import</span> <span class="n">list_models</span>

<span class="n">model_lists</span> <span class="o">=</span> <span class="n">list_models</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s2">&quot;VISUAL_PROMPTING&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model_lists</span><span class="p">)</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">[&#39;sam_tiny_vit&#39;, &#39;sam_vit_b&#39;, &#39;openvino_model&#39;]</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>2. On this step we will configure configuration
with:</p>
<ul class="simple">
<li><p>all necessary configs for sam_tiny_vit</p></li>
<li><p>train/validation sets, based on provided annotation.</p></li>
</ul>
<p>It may be counterintuitive, but for <code class="docutils literal notranslate"><span class="pre">--data_root</span></code> we need to pass the path to the dataset folder root (in our case it’s <code class="docutils literal notranslate"><span class="pre">data/wgisd</span></code>) instead of the folder with validation images.
This is because the function automatically detects annotations and images according to the expected folder structure we achieved above.</p>
<p>Let’s check the visual prompting configuration running the following command:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># or its config path</span>
<span class="o">(</span>otx<span class="o">)</span><span class="w"> </span>...$<span class="w"> </span>otx<span class="w"> </span>train<span class="w"> </span>--config<span class="w">  </span>src/otx/recipe/visual_prompting/sam_tiny_vit.yaml<span class="w"> </span><span class="se">\</span>
<span class="w">                     </span>--data_root<span class="w"> </span>data/wgisd<span class="w"> </span><span class="se">\</span>
<span class="w">                     </span>--work_dir<span class="w"> </span>otx-workspace<span class="w"> </span><span class="se">\</span>
<span class="w">                     </span>--print_config

...
data_root:<span class="w"> </span>data/wgisd
work_dir:<span class="w"> </span>otx-workspace
callback_monitor:<span class="w"> </span>val/f1-score
disable_infer_num_classes:<span class="w"> </span><span class="nb">false</span>
engine:
<span class="w">  </span>task:<span class="w"> </span>VISUAL_PROMPTING
<span class="w">  </span>device:<span class="w"> </span>auto
data:
...
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you want to get configuration as yaml file, please use <code class="docutils literal notranslate"><span class="pre">--print_config</span></code> parameter and <code class="docutils literal notranslate"><span class="pre">&gt;</span> <span class="pre">configs.yaml</span></code>.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>otx<span class="o">)</span><span class="w"> </span>...$<span class="w"> </span>otx<span class="w"> </span>train<span class="w"> </span>--config<span class="w">  </span>src/otx/recipe/visual_prompting/sam_tiny_vit.yaml<span class="w"> </span>--data_root<span class="w"> </span>data/wgisd<span class="w"> </span>--print_config<span class="w"> </span>&gt;<span class="w"> </span>configs.yaml
<span class="c1"># Update configs.yaml &amp; Train configs.yaml</span>
<span class="o">(</span>otx<span class="o">)</span><span class="w"> </span>...$<span class="w"> </span>otx<span class="w"> </span>train<span class="w"> </span>--config<span class="w"> </span>configs.yaml
</pre></div>
</div>
</div>
<p>3. <code class="docutils literal notranslate"><span class="pre">otx</span> <span class="pre">train</span></code> trains a model (a particular model template)
on a dataset and results:</p>
<p>Here are the main outputs can expect with CLI:
- <code class="docutils literal notranslate"><span class="pre">{work_dir}/{timestamp}/checkpoints/epoch_*.ckpt</span></code> - a model checkpoint file.
- <code class="docutils literal notranslate"><span class="pre">{work_dir}/{timestamp}/configs.yaml</span></code> - The configuration file used in the training can be reused to reproduce the training.
- <code class="docutils literal notranslate"><span class="pre">{work_dir}/.latest</span></code> - The results of each of the most recently executed subcommands are soft-linked. This allows you to skip checkpoints and config file entry as a workspace.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-2" name="sd-tab-set-1" type="radio">
<label class="sd-tab-label" for="sd-tab-item-2">
CLI (auto-config)</label><div class="sd-tab-content docutils">
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>otx<span class="o">)</span><span class="w"> </span>...$<span class="w"> </span>otx<span class="w"> </span>train<span class="w"> </span>--data_root<span class="w"> </span>data/wgisd<span class="w"> </span>--task<span class="w"> </span>VISUAL_PROMPTING
</pre></div>
</div>
</div>
<input id="sd-tab-item-3" name="sd-tab-set-1" type="radio">
<label class="sd-tab-label" for="sd-tab-item-3">
CLI (with config)</label><div class="sd-tab-content docutils">
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>otx<span class="o">)</span><span class="w"> </span>...$<span class="w"> </span>otx<span class="w"> </span>train<span class="w"> </span>--config<span class="w"> </span>src/otx/recipe/visual_prompting/sam_tiny_vit.yaml<span class="w"> </span>--data_root<span class="w"> </span>data/wgisd
</pre></div>
</div>
</div>
<input id="sd-tab-item-4" name="sd-tab-set-1" type="radio">
<label class="sd-tab-label" for="sd-tab-item-4">
API (from_config)</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">otx.engine</span> <span class="kn">import</span> <span class="n">Engine</span>

<span class="n">data_root</span> <span class="o">=</span> <span class="s2">&quot;data/wgisd&quot;</span>
<span class="n">recipe</span> <span class="o">=</span> <span class="s2">&quot;src/otx/recipe/visual_prompting/sam_tiny_vit.yaml&quot;</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">Engine</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span>
          <span class="n">config_path</span><span class="o">=</span><span class="n">recipe</span><span class="p">,</span>
          <span class="n">data_root</span><span class="o">=</span><span class="n">data_root</span><span class="p">,</span>
          <span class="n">work_dir</span><span class="o">=</span><span class="s2">&quot;otx-workspace&quot;</span><span class="p">,</span>
        <span class="p">)</span>

<span class="n">engine</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-5" name="sd-tab-set-1" type="radio">
<label class="sd-tab-label" for="sd-tab-item-5">
API</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">otx.engine</span> <span class="kn">import</span> <span class="n">Engine</span>

<span class="n">data_root</span> <span class="o">=</span> <span class="s2">&quot;data/wgisd&quot;</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">Engine</span><span class="p">(</span>
          <span class="n">model</span><span class="o">=</span><span class="s2">&quot;sam_tiny_vit&quot;</span><span class="p">,</span>
          <span class="n">task</span><span class="o">=</span><span class="s2">&quot;VISUAL_PROMPTING&quot;</span><span class="p">,</span>
          <span class="n">data_root</span><span class="o">=</span><span class="n">data_root</span><span class="p">,</span>
          <span class="n">work_dir</span><span class="o">=</span><span class="s2">&quot;otx-workspace&quot;</span><span class="p">,</span>
        <span class="p">)</span>

<span class="n">engine</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Because the dataset structure is mostly the same as detection, VISUAL_PROMPTING requires the task type to be specified to enable auto-configuration.</p>
</div>
<p>4. <code class="docutils literal notranslate"><span class="pre">(Optional)</span></code> Additionally, we can tune training parameters such as batch size, learning rate, patience epochs or warm-up iterations.
Learn more about template-specific parameters using <code class="docutils literal notranslate"><span class="pre">otx</span> <span class="pre">train</span> <span class="pre">params</span> <span class="pre">--help</span></code>.</p>
<p>It can be done by manually updating parameters in the <code class="docutils literal notranslate"><span class="pre">template.yaml</span></code> file in your workplace or via the command line.</p>
<p>For example, to increase the batch size to 4, fix the number of epochs to 100, extend the command line above with the following line.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-6" name="sd-tab-set-2" type="radio">
<label class="sd-tab-label" for="sd-tab-item-6">
CLI</label><div class="sd-tab-content docutils">
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>otx<span class="o">)</span><span class="w"> </span>...$<span class="w"> </span>otx<span class="w"> </span>train<span class="w"> </span>...<span class="w"> </span>--data.train_subset.batch_size<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="se">\</span>
<span class="w">                         </span>--max_epochs<span class="w"> </span><span class="m">100</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-7" name="sd-tab-set-2" type="radio">
<label class="sd-tab-label" for="sd-tab-item-7">
API</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">otx.core.config.data</span> <span class="kn">import</span> <span class="n">SubsetConfig</span>
<span class="kn">from</span> <span class="nn">otx.core.data.module</span> <span class="kn">import</span> <span class="n">OTXDataModule</span>
<span class="kn">from</span> <span class="nn">otx.engine</span> <span class="kn">import</span> <span class="n">Engine</span>

<span class="n">datamodule</span> <span class="o">=</span> <span class="n">OTXDataModule</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">train_subset</span><span class="o">=</span><span class="n">SubsetConfig</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">Engine</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">datamodule</span><span class="o">=</span><span class="n">datamodule</span><span class="p">)</span>

<span class="n">engine</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">max_epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>5. The training result <code class="docutils literal notranslate"><span class="pre">checkpoints/*.ckpt</span></code> file is located in <code class="docutils literal notranslate"><span class="pre">{work_dir}</span></code> folder,
while training logs can be found in the <code class="docutils literal notranslate"><span class="pre">{work_dir}/{timestamp}</span></code> dir.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We also can visualize the training using <code class="docutils literal notranslate"><span class="pre">Tensorboard</span></code> as these logs are located in <code class="docutils literal notranslate"><span class="pre">{work_dir}/{timestamp}/tensorboard</span></code>.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>otx-workspace
├── 20240403_134256/
    ├── csv/
    ├── checkpoints/
    |   └── epoch_*.pth
    ├── tensorboard/
    └── configs.yaml
└── .latest
    └── train/
...
</pre></div>
</div>
<p>The training time highly relies on the hardware characteristics, for example on 1 NVIDIA GeForce RTX 3090 the training took about 4 minutes.</p>
<p>After that, we have the PyTorch visual prompting model trained with OpenVINO™ Training Extensions, which we can use for evaluation, export, optimization and deployment.</p>
</section>
<section id="evaluation">
<h2>Evaluation<a class="headerlink" href="#evaluation" title="Link to this heading">#</a></h2>
<p>1. <code class="docutils literal notranslate"><span class="pre">otx</span> <span class="pre">test</span></code> runs evaluation of a
trained model on a particular dataset.</p>
<p>Test function receives test annotation information and model snapshot, trained in previous step.</p>
<p>The default metric is f1-score measure.</p>
<p>2. That’s how we can evaluate the snapshot in <code class="docutils literal notranslate"><span class="pre">otx-workspace</span></code>
folder on WGISD dataset and save results to <code class="docutils literal notranslate"><span class="pre">otx-workspace</span></code>:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-8" name="sd-tab-set-3" type="radio">
<label class="sd-tab-label" for="sd-tab-item-8">
CLI (with work_dir)</label><div class="sd-tab-content docutils">
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>otx<span class="o">)</span><span class="w"> </span>...$<span class="w"> </span>otx<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--work_dir<span class="w"> </span>otx-workspace
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span class="w">        </span>Test<span class="w"> </span>metric<span class="w">        </span>┃<span class="w">       </span>DataLoader<span class="w"> </span><span class="m">0</span><span class="w">        </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│<span class="w">      </span>test/data_time<span class="w">       </span>│<span class="w">   </span><span class="m">0</span>.0009265312692150474<span class="w">   </span>│
│<span class="w">         </span>test/dice<span class="w">         </span>│<span class="w">    </span><span class="m">0</span>.9201090335845947<span class="w">     </span>│
│<span class="w">       </span>test/f1-score<span class="w">       </span>│<span class="w">    </span><span class="m">0</span>.9201071262359619<span class="w">     </span>│
│<span class="w">         </span>test/iou<span class="w">          </span>│<span class="w">    </span><span class="m">0</span>.8520355224609375<span class="w">     </span>│
│<span class="w">      </span>test/iter_time<span class="w">       </span>│<span class="w">    </span><span class="m">0</span>.3015514016151428<span class="w">     </span>│
│<span class="w">         </span>test/map<span class="w">          </span>│<span class="w">    </span><span class="m">0</span>.5886790156364441<span class="w">     </span>│
│<span class="w">        </span>test/map_50<span class="w">        </span>│<span class="w">    </span><span class="m">0</span>.9061686396598816<span class="w">     </span>│
│<span class="w">        </span>test/map_75<span class="w">        </span>│<span class="w">    </span><span class="m">0</span>.6716098785400391<span class="w">     </span>│
│<span class="w">      </span>test/map_large<span class="w">       </span>│<span class="w">    </span><span class="m">0</span>.7401198148727417<span class="w">     </span>│
│<span class="w">      </span>test/map_medium<span class="w">      </span>│<span class="w">    </span><span class="m">0</span>.5705212950706482<span class="w">     </span>│
│<span class="w">    </span>test/map_per_class<span class="w">     </span>│<span class="w">           </span>-1.0<span class="w">            </span>│
│<span class="w">      </span>test/map_small<span class="w">       </span>│<span class="w">    </span><span class="m">0</span>.21598181128501892<span class="w">    </span>│
│<span class="w">        </span>test/mar_1<span class="w">         </span>│<span class="w">    </span><span class="m">0</span>.03824029490351677<span class="w">    </span>│
│<span class="w">        </span>test/mar_10<span class="w">        </span>│<span class="w">    </span><span class="m">0</span>.3468073010444641<span class="w">     </span>│
│<span class="w">       </span>test/mar_100<span class="w">        </span>│<span class="w">     </span><span class="m">0</span>.614170253276825<span class="w">     </span>│
│<span class="w">  </span>test/mar_100_per_class<span class="w">   </span>│<span class="w">           </span>-1.0<span class="w">            </span>│
│<span class="w">      </span>test/mar_large<span class="w">       </span>│<span class="w">     </span><span class="m">0</span>.766523003578186<span class="w">     </span>│
│<span class="w">      </span>test/mar_medium<span class="w">      </span>│<span class="w">     </span><span class="m">0</span>.599896252155304<span class="w">     </span>│
│<span class="w">      </span>test/mar_small<span class="w">       </span>│<span class="w">    </span><span class="m">0</span>.2501521706581116<span class="w">     </span>│
└───────────────────────────┴───────────────────────────┘
</pre></div>
</div>
</div>
<input id="sd-tab-item-9" name="sd-tab-set-3" type="radio">
<label class="sd-tab-label" for="sd-tab-item-9">
CLI (with config)</label><div class="sd-tab-content docutils">
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>otx<span class="o">)</span><span class="w"> </span>...$<span class="w"> </span>otx<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--config<span class="w"> </span>src/otx/recipe/visual_prompting/sam_tiny_vit.yaml<span class="w"> </span><span class="se">\</span>
<span class="w">                    </span>--data_root<span class="w"> </span>data/wgisd<span class="w"> </span><span class="se">\</span>
<span class="w">                    </span>--checkpoint<span class="w"> </span>otx-workspace/.latest/train/checkpoints/epoch_009.ckpt
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span class="w">        </span>Test<span class="w"> </span>metric<span class="w">        </span>┃<span class="w">       </span>DataLoader<span class="w"> </span><span class="m">0</span><span class="w">        </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│<span class="w">      </span>test/data_time<span class="w">       </span>│<span class="w">   </span><span class="m">0</span>.0009342798730358481<span class="w">   </span>│
│<span class="w">         </span>test/dice<span class="w">         </span>│<span class="w">    </span><span class="m">0</span>.9201090335845947<span class="w">     </span>│
│<span class="w">       </span>test/f1-score<span class="w">       </span>│<span class="w">    </span><span class="m">0</span>.9201071262359619<span class="w">     </span>│
│<span class="w">         </span>test/iou<span class="w">          </span>│<span class="w">    </span><span class="m">0</span>.8520355224609375<span class="w">     </span>│
│<span class="w">      </span>test/iter_time<span class="w">       </span>│<span class="w">    </span><span class="m">0</span>.31654438376426697<span class="w">    </span>│
│<span class="w">         </span>test/map<span class="w">          </span>│<span class="w">    </span><span class="m">0</span>.5886790156364441<span class="w">     </span>│
│<span class="w">        </span>test/map_50<span class="w">        </span>│<span class="w">    </span><span class="m">0</span>.9061686396598816<span class="w">     </span>│
│<span class="w">        </span>test/map_75<span class="w">        </span>│<span class="w">    </span><span class="m">0</span>.6716098785400391<span class="w">     </span>│
│<span class="w">      </span>test/map_large<span class="w">       </span>│<span class="w">    </span><span class="m">0</span>.7401198148727417<span class="w">     </span>│
│<span class="w">      </span>test/map_medium<span class="w">      </span>│<span class="w">    </span><span class="m">0</span>.5705212950706482<span class="w">     </span>│
│<span class="w">    </span>test/map_per_class<span class="w">     </span>│<span class="w">           </span>-1.0<span class="w">            </span>│
│<span class="w">      </span>test/map_small<span class="w">       </span>│<span class="w">    </span><span class="m">0</span>.21598181128501892<span class="w">    </span>│
│<span class="w">        </span>test/mar_1<span class="w">         </span>│<span class="w">    </span><span class="m">0</span>.03824029490351677<span class="w">    </span>│
│<span class="w">        </span>test/mar_10<span class="w">        </span>│<span class="w">    </span><span class="m">0</span>.3468073010444641<span class="w">     </span>│
│<span class="w">       </span>test/mar_100<span class="w">        </span>│<span class="w">     </span><span class="m">0</span>.614170253276825<span class="w">     </span>│
│<span class="w">  </span>test/mar_100_per_class<span class="w">   </span>│<span class="w">           </span>-1.0<span class="w">            </span>│
│<span class="w">      </span>test/mar_large<span class="w">       </span>│<span class="w">     </span><span class="m">0</span>.766523003578186<span class="w">     </span>│
│<span class="w">      </span>test/mar_medium<span class="w">      </span>│<span class="w">     </span><span class="m">0</span>.599896252155304<span class="w">     </span>│
│<span class="w">      </span>test/mar_small<span class="w">       </span>│<span class="w">    </span><span class="m">0</span>.2501521706581116<span class="w">     </span>│
└───────────────────────────┴───────────────────────────┘
</pre></div>
</div>
</div>
<input id="sd-tab-item-10" name="sd-tab-set-3" type="radio">
<label class="sd-tab-label" for="sd-tab-item-10">
API</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span><span class="o">.</span><span class="n">test</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>3. The output of <code class="docutils literal notranslate"><span class="pre">{work_dir}/{timestamp}/csv/version_0/metrics.csv</span></code> consists of
a dict with target metric name and its value.</p>
</section>
<section id="export">
<h2>Export<a class="headerlink" href="#export" title="Link to this heading">#</a></h2>
<p>1. <code class="docutils literal notranslate"><span class="pre">otx</span> <span class="pre">export</span></code> exports a trained Pytorch <cite>.pth</cite> model to the OpenVINO™ Intermediate Representation (IR) format.
It allows to efficiently run it on Intel hardware, especially on CPU, using OpenVINO™ runtime.
Also, the resulting IR model is required to run PTQ optimization in the section below. IR model contains 4 files: <code class="docutils literal notranslate"><span class="pre">exported_model_image_encoder.xml</span></code> and <code class="docutils literal notranslate"><span class="pre">exported_model_decoder.xml</span></code> for architecture and <code class="docutils literal notranslate"><span class="pre">exported_model_image_encoder.bin</span></code> and <code class="docutils literal notranslate"><span class="pre">exported_model_decoder.bin</span></code> for weights.</p>
<p>2. That’s how we can export the trained model <code class="docutils literal notranslate"><span class="pre">{work_dir}/{timestamp}/checkpoints/epoch_*.ckpt</span></code>
from the previous section and save the exported model to the <code class="docutils literal notranslate"><span class="pre">{work_dir}/{timestamp}/</span></code> folder.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-11" name="sd-tab-set-4" type="radio">
<label class="sd-tab-label" for="sd-tab-item-11">
CLI (with work_dir)</label><div class="sd-tab-content docutils">
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>otx<span class="o">)</span><span class="w"> </span>...$<span class="w"> </span>otx<span class="w"> </span><span class="nb">export</span><span class="w"> </span>--work_dir<span class="w"> </span>otx-workspace
...
Elapsed<span class="w"> </span>time:<span class="w"> </span><span class="m">0</span>:00:05.396129
</pre></div>
</div>
</div>
<input id="sd-tab-item-12" name="sd-tab-set-4" type="radio">
<label class="sd-tab-label" for="sd-tab-item-12">
CLI (with config)</label><div class="sd-tab-content docutils">
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>otx<span class="o">)</span><span class="w"> </span>...$<span class="w"> </span>otx<span class="w"> </span><span class="nb">export</span><span class="w"> </span>...<span class="w"> </span>--checkpoint<span class="w"> </span>otx-workspace/.latest/train/checkpoints/epoch_009.ckpt
...
Elapsed<span class="w"> </span>time:<span class="w"> </span><span class="m">0</span>:00:05.313879
</pre></div>
</div>
</div>
<input id="sd-tab-item-13" name="sd-tab-set-4" type="radio">
<label class="sd-tab-label" for="sd-tab-item-13">
API</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span><span class="o">.</span><span class="n">export</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>3. We can check the accuracy of the IR model and the consistency between the exported model and the PyTorch model,
using <code class="docutils literal notranslate"><span class="pre">otx</span> <span class="pre">test</span></code> and passing the IR model path to the <code class="docutils literal notranslate"><span class="pre">--checkpoint</span></code> parameter.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-14" name="sd-tab-set-5" type="radio">
<label class="sd-tab-label" for="sd-tab-item-14">
CLI (with work_dir)</label><div class="sd-tab-content docutils">
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>otx<span class="o">)</span><span class="w"> </span>...$<span class="w"> </span>otx<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--work_dir<span class="w"> </span>otx-workspace<span class="w"> </span><span class="se">\</span>
<span class="w">                    </span>--checkpoint<span class="w"> </span>otx-workspace/.latest/export/exported_model_decoder.xml<span class="w"> </span><span class="se">\</span>
<span class="w">                    </span>--engine.device<span class="w"> </span>cpu
...
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span class="w">        </span>Test<span class="w"> </span>metric<span class="w">        </span>┃<span class="w">       </span>DataLoader<span class="w"> </span><span class="m">0</span><span class="w">        </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│<span class="w">      </span>test/data_time<span class="w">       </span>│<span class="w">   </span><span class="m">0</span>.0007283412269316614<span class="w">   </span>│
│<span class="w">         </span>test/dice<span class="w">         </span>│<span class="w">    </span><span class="m">0</span>.9990837574005127<span class="w">     </span>│
│<span class="w">       </span>test/f1-score<span class="w">       </span>│<span class="w">    </span><span class="m">0</span>.9169966578483582<span class="w">     </span>│
│<span class="w">         </span>test/iou<span class="w">          </span>│<span class="w">    </span><span class="m">0</span>.8467163443565369<span class="w">     </span>│
│<span class="w">      </span>test/iter_time<span class="w">       </span>│<span class="w">    </span><span class="m">3</span>.1121630668640137<span class="w">     </span>│
│<span class="w">         </span>test/map<span class="w">          </span>│<span class="w">    </span><span class="m">0</span>.47309553623199463<span class="w">    </span>│
│<span class="w">        </span>test/map_50<span class="w">        </span>│<span class="w">    </span><span class="m">0</span>.8371172547340393<span class="w">     </span>│
│<span class="w">        </span>test/map_75<span class="w">        </span>│<span class="w">    </span><span class="m">0</span>.5044668912887573<span class="w">     </span>│
│<span class="w">      </span>test/map_large<span class="w">       </span>│<span class="w">    </span><span class="m">0</span>.6876431107521057<span class="w">     </span>│
│<span class="w">      </span>test/map_medium<span class="w">      </span>│<span class="w">    </span><span class="m">0</span>.5046071410179138<span class="w">     </span>│
│<span class="w">    </span>test/map_per_class<span class="w">     </span>│<span class="w">           </span>-1.0<span class="w">            </span>│
│<span class="w">      </span>test/map_small<span class="w">       </span>│<span class="w">    </span><span class="m">0</span>.11672457307577133<span class="w">    </span>│
│<span class="w">        </span>test/mar_1<span class="w">         </span>│<span class="w">    </span><span class="m">0</span>.02601064182817936<span class="w">    </span>│
│<span class="w">        </span>test/mar_10<span class="w">        </span>│<span class="w">    </span><span class="m">0</span>.26142847537994385<span class="w">    </span>│
│<span class="w">       </span>test/mar_100<span class="w">        </span>│<span class="w">    </span><span class="m">0</span>.6027402281761169<span class="w">     </span>│
│<span class="w">  </span>test/mar_100_per_class<span class="w">   </span>│<span class="w">           </span>-1.0<span class="w">            </span>│
│<span class="w">      </span>test/mar_large<span class="w">       </span>│<span class="w">    </span><span class="m">0</span>.7594292163848877<span class="w">     </span>│
│<span class="w">      </span>test/mar_medium<span class="w">      </span>│<span class="w">    </span><span class="m">0</span>.5897444486618042<span class="w">     </span>│
│<span class="w">      </span>test/mar_small<span class="w">       </span>│<span class="w">    </span><span class="m">0</span>.22268414497375488<span class="w">    </span>│
└───────────────────────────┴───────────────────────────┘
</pre></div>
</div>
</div>
<input id="sd-tab-item-15" name="sd-tab-set-5" type="radio">
<label class="sd-tab-label" for="sd-tab-item-15">
CLI (with config)</label><div class="sd-tab-content docutils">
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>otx<span class="o">)</span><span class="w"> </span>...$<span class="w"> </span>otx<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--config<span class="w"> </span>src/otx/recipe/visual_prompting/sam_tiny_vit.yaml<span class="w"> </span><span class="se">\</span>
<span class="w">                    </span>--data_root<span class="w"> </span>data/wgisd<span class="w"> </span><span class="se">\</span>
<span class="w">                    </span>--checkpoint<span class="w"> </span>otx-workspace/.latest/export/exported_model_decoder.xml<span class="w"> </span><span class="se">\</span>
<span class="w">                    </span>--engine.device<span class="w"> </span>cpu
...
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span class="w">        </span>Test<span class="w"> </span>metric<span class="w">        </span>┃<span class="w">       </span>DataLoader<span class="w"> </span><span class="m">0</span><span class="w">        </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│<span class="w">      </span>test/data_time<span class="w">       </span>│<span class="w">   </span><span class="m">0</span>.0007516053738072515<span class="w">   </span>│
│<span class="w">         </span>test/dice<span class="w">         </span>│<span class="w">    </span><span class="m">0</span>.9990837574005127<span class="w">     </span>│
│<span class="w">       </span>test/f1-score<span class="w">       </span>│<span class="w">    </span><span class="m">0</span>.9169966578483582<span class="w">     </span>│
│<span class="w">         </span>test/iou<span class="w">          </span>│<span class="w">    </span><span class="m">0</span>.8467163443565369<span class="w">     </span>│
│<span class="w">      </span>test/iter_time<span class="w">       </span>│<span class="w">     </span><span class="m">3</span>.09753680229187<span class="w">      </span>│
│<span class="w">         </span>test/map<span class="w">          </span>│<span class="w">    </span><span class="m">0</span>.47309553623199463<span class="w">    </span>│
│<span class="w">        </span>test/map_50<span class="w">        </span>│<span class="w">    </span><span class="m">0</span>.8371172547340393<span class="w">     </span>│
│<span class="w">        </span>test/map_75<span class="w">        </span>│<span class="w">    </span><span class="m">0</span>.5044668912887573<span class="w">     </span>│
│<span class="w">      </span>test/map_large<span class="w">       </span>│<span class="w">    </span><span class="m">0</span>.6876431107521057<span class="w">     </span>│
│<span class="w">      </span>test/map_medium<span class="w">      </span>│<span class="w">    </span><span class="m">0</span>.5046071410179138<span class="w">     </span>│
│<span class="w">    </span>test/map_per_class<span class="w">     </span>│<span class="w">           </span>-1.0<span class="w">            </span>│
│<span class="w">      </span>test/map_small<span class="w">       </span>│<span class="w">    </span><span class="m">0</span>.11672457307577133<span class="w">    </span>│
│<span class="w">        </span>test/mar_1<span class="w">         </span>│<span class="w">    </span><span class="m">0</span>.02601064182817936<span class="w">    </span>│
│<span class="w">        </span>test/mar_10<span class="w">        </span>│<span class="w">    </span><span class="m">0</span>.26142847537994385<span class="w">    </span>│
│<span class="w">       </span>test/mar_100<span class="w">        </span>│<span class="w">    </span><span class="m">0</span>.6027402281761169<span class="w">     </span>│
│<span class="w">  </span>test/mar_100_per_class<span class="w">   </span>│<span class="w">           </span>-1.0<span class="w">            </span>│
│<span class="w">      </span>test/mar_large<span class="w">       </span>│<span class="w">    </span><span class="m">0</span>.7594292163848877<span class="w">     </span>│
│<span class="w">      </span>test/mar_medium<span class="w">      </span>│<span class="w">    </span><span class="m">0</span>.5897444486618042<span class="w">     </span>│
│<span class="w">      </span>test/mar_small<span class="w">       </span>│<span class="w">    </span><span class="m">0</span>.22268414497375488<span class="w">    </span>│
└───────────────────────────┴───────────────────────────┘
</pre></div>
</div>
</div>
<input id="sd-tab-item-16" name="sd-tab-set-5" type="radio">
<label class="sd-tab-label" for="sd-tab-item-16">
API</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">exported_model</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">export</span><span class="p">()</span>
<span class="n">engine</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">checkpoint</span><span class="o">=</span><span class="n">exported_model</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Visual prompting task has two IR models unlike other tasks.
But it doesn’t matter which one to be inserted to <code class="docutils literal notranslate"><span class="pre">--checkpoint</span></code> for testing because OTX will automatically load both IR models.</p>
</div>
<p>4. <code class="docutils literal notranslate"><span class="pre">Optional</span></code> Additionally, we can tune confidence threshold via the command line.
Learn more about template-specific parameters using <code class="docutils literal notranslate"><span class="pre">otx</span> <span class="pre">export</span> <span class="pre">--help</span></code>.</p>
<p>For example, If you want to get the ONNX model format you can run it like below.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-17" name="sd-tab-set-6" type="radio">
<label class="sd-tab-label" for="sd-tab-item-17">
CLI</label><div class="sd-tab-content docutils">
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>otx<span class="o">)</span><span class="w"> </span>...$<span class="w"> </span>otx<span class="w"> </span><span class="nb">export</span><span class="w"> </span>...<span class="w"> </span>--checkpoint<span class="w"> </span>otx-workspace/.latest/train/checkpoints/epoch_009.ckpt<span class="w"> </span>--export_format<span class="w"> </span>ONNX
</pre></div>
</div>
</div>
<input id="sd-tab-item-18" name="sd-tab-set-6" type="radio">
<label class="sd-tab-label" for="sd-tab-item-18">
API</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">export_format</span><span class="o">=</span><span class="s2">&quot;ONNX&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="optimization">
<h2>Optimization<a class="headerlink" href="#optimization" title="Link to this heading">#</a></h2>
<p>1. We can further optimize the model with <code class="docutils literal notranslate"><span class="pre">otx</span> <span class="pre">optimize</span></code>.
It uses PTQ depending on the model and transforms it to <code class="docutils literal notranslate"><span class="pre">INT8</span></code> format.</p>
<p><code class="docutils literal notranslate"><span class="pre">PTQ</span></code> optimization is used for models exported in the OpenVINO™ IR format. It decreases the floating-point precision to integer precision of the exported model by performing the post-training optimization.</p>
<p>To learn more about optimization, refer to <a class="reference external" href="https://github.com/openvinotoolkit/nncf">NNCF repository</a>.</p>
<p>2.  Command example for optimizing OpenVINO™ model (.xml)
with OpenVINO™ PTQ.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-19" name="sd-tab-set-7" type="radio">
<label class="sd-tab-label" for="sd-tab-item-19">
CLI</label><div class="sd-tab-content docutils">
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>otx<span class="o">)</span><span class="w"> </span>...$<span class="w"> </span>otx<span class="w"> </span>optimize<span class="w">  </span>--work_dir<span class="w"> </span>otx-workspace<span class="w"> </span><span class="se">\</span>
<span class="w">                         </span>--checkpoint<span class="w"> </span>otx-workspace/.latest/export/exported_model_decoder.xml<span class="w"> </span><span class="se">\</span>
<span class="w">                         </span>--data.train_subset.num_workers<span class="w"> </span><span class="m">0</span>

...
Statistics<span class="w"> </span>collection<span class="w"> </span>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━<span class="w"> </span><span class="m">100</span>%<span class="w"> </span><span class="m">55</span>/55<span class="w"> </span>•<span class="w"> </span><span class="m">0</span>:00:35<span class="w"> </span>•<span class="w"> </span><span class="m">0</span>:00:00
Applying<span class="w"> </span>Fast<span class="w"> </span>Bias<span class="w"> </span>correction<span class="w"> </span>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━<span class="w"> </span><span class="m">100</span>%<span class="w"> </span><span class="m">50</span>/50<span class="w"> </span>•<span class="w"> </span><span class="m">0</span>:00:01<span class="w"> </span>•<span class="w"> </span><span class="m">0</span>:00:00
Elapsed<span class="w"> </span>time:<span class="w"> </span><span class="m">0</span>:04:28.609954
</pre></div>
</div>
</div>
<input id="sd-tab-item-20" name="sd-tab-set-7" type="radio">
<label class="sd-tab-label" for="sd-tab-item-20">
API</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ckpt_path</span> <span class="o">=</span> <span class="s2">&quot;otx-workspace/.latest/export/exported_model_decoder.xml&quot;</span>
<span class="n">engine</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">checkpoint</span><span class="o">=</span><span class="n">ckpt_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The optimization time highly relies on the hardware characteristics, for example on Intel(R) Core(TM) i9-11900 it took about 10 minutes.
Please note, that PTQ will take some time without logging to optimize the model.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Optimization is performed in the following order: image encoder  then decoder.
Because the optimized image encoder is used for decoder optimization, segmentation fault error can occur when releasing threads and memories after optimization step.
It doesn’t affect optimization results, but it’s recommended to set <code class="docutils literal notranslate"><span class="pre">--data.train_subset.num_workers</span> <span class="pre">0</span></code> to avoid this error.</p>
</div>
<p>3. Finally, we can also evaluate the optimized model by passing
it to the <code class="docutils literal notranslate"><span class="pre">otx</span> <span class="pre">test</span></code> function.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-21" name="sd-tab-set-8" type="radio">
<label class="sd-tab-label" for="sd-tab-item-21">
CLI</label><div class="sd-tab-content docutils">
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>otx<span class="o">)</span><span class="w"> </span>...$<span class="w"> </span>otx<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--work_dir<span class="w"> </span>otx-workspace<span class="w"> </span><span class="se">\</span>
<span class="w">                    </span>--checkpoint<span class="w"> </span>otx-workspace/.latest/optimize/optimized_model_decoder.xml<span class="w"> </span><span class="se">\</span>
<span class="w">                    </span>--engine.device<span class="w"> </span>cpu

...
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span class="w">        </span>Test<span class="w"> </span>metric<span class="w">        </span>┃<span class="w">       </span>DataLoader<span class="w"> </span><span class="m">0</span><span class="w">        </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│<span class="w">      </span>test/data_time<span class="w">       </span>│<span class="w">   </span><span class="m">0</span>.0007440951885655522<span class="w">   </span>│
│<span class="w">         </span>test/dice<span class="w">         </span>│<span class="w">     </span><span class="m">0</span>.998199462890625<span class="w">     </span>│
│<span class="w">       </span>test/f1-score<span class="w">       </span>│<span class="w">     </span><span class="m">0</span>.853766918182373<span class="w">     </span>│
│<span class="w">         </span>test/iou<span class="w">          </span>│<span class="w">    </span><span class="m">0</span>.7448458075523376<span class="w">     </span>│
│<span class="w">      </span>test/iter_time<span class="w">       </span>│<span class="w">    </span><span class="m">2</span>.8865625858306885<span class="w">     </span>│
│<span class="w">         </span>test/map<span class="w">          </span>│<span class="w">    </span><span class="m">0</span>.23295165598392487<span class="w">    </span>│
│<span class="w">        </span>test/map_50<span class="w">        </span>│<span class="w">    </span><span class="m">0</span>.5494663119316101<span class="w">     </span>│
│<span class="w">        </span>test/map_75<span class="w">        </span>│<span class="w">    </span><span class="m">0</span>.15102604031562805<span class="w">    </span>│
│<span class="w">      </span>test/map_large<span class="w">       </span>│<span class="w">    </span><span class="m">0</span>.45290130376815796<span class="w">    </span>│
│<span class="w">      </span>test/map_medium<span class="w">      </span>│<span class="w">    </span><span class="m">0</span>.16153287887573242<span class="w">    </span>│
│<span class="w">    </span>test/map_per_class<span class="w">     </span>│<span class="w">           </span>-1.0<span class="w">            </span>│
│<span class="w">      </span>test/map_small<span class="w">       </span>│<span class="w">   </span><span class="m">0</span>.012729672715067863<span class="w">    </span>│
│<span class="w">        </span>test/mar_1<span class="w">         </span>│<span class="w">   </span><span class="m">0</span>.014449129812419415<span class="w">    </span>│
│<span class="w">        </span>test/mar_10<span class="w">        </span>│<span class="w">    </span><span class="m">0</span>.15996699035167694<span class="w">    </span>│
│<span class="w">       </span>test/mar_100<span class="w">        </span>│<span class="w">    </span><span class="m">0</span>.3901452422142029<span class="w">     </span>│
│<span class="w">  </span>test/mar_100_per_class<span class="w">   </span>│<span class="w">           </span>-1.0<span class="w">            </span>│
│<span class="w">      </span>test/mar_large<span class="w">       </span>│<span class="w">    </span><span class="m">0</span>.5868775844573975<span class="w">     </span>│
│<span class="w">      </span>test/mar_medium<span class="w">      </span>│<span class="w">    </span><span class="m">0</span>.30925533175468445<span class="w">    </span>│
│<span class="w">      </span>test/mar_small<span class="w">       </span>│<span class="w">   </span><span class="m">0</span>.027198636904358864<span class="w">    </span>│
└───────────────────────────┴───────────────────────────┘
</pre></div>
</div>
</div>
<input id="sd-tab-item-22" name="sd-tab-set-8" type="radio">
<label class="sd-tab-label" for="sd-tab-item-22">
API</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ckpt_path</span> <span class="o">=</span> <span class="s2">&quot;otx-workspace/.latest/optimize/optimized_model_decoder.xml&quot;</span>
<span class="n">engine</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">checkpoint</span><span class="o">=</span><span class="n">ckpt_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Visual prompting task has two IR models unlike other tasks.
But it doesn’t matter which one to be inserted to <code class="docutils literal notranslate"><span class="pre">--checkpoint</span></code> for testing because OTX will automatically load both IR models.</p>
</div>
<p>Now we have fully trained, optimized and exported an efficient model representation ready-to-use visual prompting model.</p>
</section>
</section>


            </article>
            
            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="action_classification.html" title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">Action Classification model</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="../explain.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">XAI Tutorial</p>
  </div>
  <i class="fa-solid fa-angle-right"></i>
  </a>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup-virtual-environment">
   Setup virtual environment
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dataset-preparation">
   Dataset preparation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#training">
   Training
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#evaluation">
   Evaluation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#export">
   Export
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#optimization">
   Optimization
  </a>
 </li>
</ul>

</nav>
</div>

<div class="toc-item">
  
<div id="searchbox"></div>
</div>

<div class="toc-item">
  
</div>

<div class="toc-item">
  
<div class="tocsection sourcelink">
    <a href="../../../../_sources/guide/tutorials/base/how_to_train/visual_prompting.rst.txt">
        <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
</div>

</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
          </div>
        </footer>
        
      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94"></script>
<script src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94"></script>

  <footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright 2024, OpenVINO™ Training Extensions Contributors.<br>

</p>

  </div>
  
  <div class="footer-item">
    <p class="theme-version">
    Built with the
    <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">
        PyData Sphinx Theme
    </a>
    0.12.0.
</p>
  </div>
  
  <div class="footer-item">
    
<p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.2.6.<br>
</p>

  </div>
  
</div>
  </footer>
  </body>
</html>